---
# This playbook configures a server with
#  - nfs-service
#  - avantra server software

- name: Ensure Servers are booted and reachable
  hosts: gcp_awx_group_management
  gather_facts: false
  become: false
  tasks:
  - name: Wait for SSH to come up
    wait_for:
      host: "{{ ansible_ssh_host }}"
      port: 22
      delay: 10
      timeout: 120
    delegate_to: localhost

- name: Install nfs Server
  hosts: gcp_awx_group_management
  become: true

  vars:
          # subscription mgmgt
          #
          reg_activation_key: "{{ sap_rhsm_activationkey }}"
          reg_organization_id: "{{ sap_rhsm_org_id }}"

          # RHN Server
          exportdirs:
             - /export/sap-software: '10.0.0.0/8(ro)'
             - /export/hana/shared: '10.0.0.0/8(rw)'

  roles:
               - mk-ansible-roles.subscribe_rhn
               # linux-system-roles.storage
               - mk-ansible-roles.setup_nfs_server
